<ng-container *ngIf="(tournament$ | async) as tournament">

  <div class="complete-your-team"
       *ngIf="tournament.participants_type === 'teams' && (isJoinedData$ | async).is_joined
       && tournament.no_of_participants_per_team > (isJoinedData$ | async).members_count &&
       (isJoinedData$ | async)?.team?.owner?.id === this.user.id">
    <div class="title">
      <span nz-icon nzType="info-circle" nzTheme="outline"></span>
      <p style="color: red">{{(isJoinedData$ | async).count}}</p>
      {{ 'tournament.summary.completeYourTeam' | translate  }}
    </div>
    <a class="action" routerLink="/tournaments/{{tournament.code}}/team-settings">
      <app-button variant="primary">{{ 'tournament.summary.completeYourTeam' | translate }}</app-button>
    </a>
  </div>
  <div class="complete-your-team"
       *ngIf="(isJoinedData$ | async)?.requests?.team_joining_request_count > 0">
    <div class="title">
      <span nz-icon nzType="info-circle" nzTheme="outline"></span>
      <div class="d-flex flex-column gap-1">
        <h2>{{ 'tournament.summary.joinRequestSend' | translate }}</h2>
        <h5>{{ 'tournament.summary.joinRequestMessage' | translate: {requestMessage: (isJoinedData$ | async).requests.team_joining_request_count} }}</h5>
      </div>
    </div>
    <a class="action">
      <app-button variant="primary" (click)="requestsDialog = true">{{ 'checkAllRequests' | translate }}</app-button>
    </a>
  </div>

  <div class="complete-your-team" *ngIf="tournament.participants_type === 'teams' && (isJoinedData$ | async).is_joined &&
       (isJoinedData$ | async)?.team?.owner?.id !== this.user.id">
    <div class="title">
      <span nz-icon nzType="info-circle" nzTheme="outline"></span>
      <div class="d-flex flex-column gap-1">
        <h5>{{ 'tournament.summary.joinedAsTeamMember' | translate }}
          <a routerLink="{{'/teams/'+ (isJoinedData$ | async)?.team?.id }}"
             style="font-weight: bold; color: #280659;text-decoration: underline;">{{(isJoinedData$ | async)?.team?.name}}</a>
          <span>{{ 'tournament.summary.joinedTeamLeader' | translate }}</span>
          <a routerLink="{{'/gamer/'+ (isJoinedData$ | async)?.team?.owner?.slug }}"
             style="font-weight: bold; color: #280659;text-decoration: underline;">{{(isJoinedData$ | async)?.team?.owner?.username}}</a>
        </h5>
      </div>
    </div>
  </div>

  <app-winners></app-winners>

  <app-timeline></app-timeline>

  <div class="row">
    <div class="col-12">

      <app-section [title]="'tournament.summary.tournamentInfo'| translate">

        <ng-scrollbar >
          <div class="gap-2 " style=" white-space: nowrap; display: flex; flex-flow: row nowrap; flex-basis:0;">

            <app-info-card [icon]="'assets/svg-icons/game_pad-icon.svg'" [title]="'common.game' | translate"
                           [subTitle]="tournament.game.data.name"></app-info-card>
            <app-info-card [icon]="'assets/svg-icons/game-pad-arrow-icon.svg'" [title]="'common.game' | translate"
                           [subTitle]="tournament.platformSlug"></app-info-card>
            <app-info-card *ngIf="tournament.participants_must_check_in"
                           [icon]="'assets/svg-icons/check-double-icon.svg'" [title]="'common.checkIn' | translate"
                           [subTitle]="'components.infoCard.subTitle.checkInMargin' | translate:{margin: tournament.check_in_margin}"></app-info-card>
            <app-info-card [icon]="'assets/svg-icons/user-info-icon.svg'" [title]="'type' | translate"
                           [subTitle]="tournament.participants_type === 'teams' ?('components.infoCard.subTitle.participantsType' | translate:   { noOfParticipantsPerTeam: tournament.no_of_participants_per_team, noOfSubstitutesPerTeam: tournament.no_of_substitutes_per_team })  : 'single'"></app-info-card>
            <app-info-card [icon]="'assets/svg-icons/users.svg'" [title]="'Participants' | translate" *ngIf="tournament.total_participants_count"
                           [subTitle]="tournament.total_participants_count"></app-info-card>

            <app-info-card [icon]="'assets/svg-icons/tournament-bracket-icon.svg'" [title]="'common.bracket'| translate"
                           [subTitle]="tournament?.tree?.data?.[0]?.type"></app-info-card>

            <div class="game-settings" [style.background-image]="'url('+tournament.game.data.cover+')'"
                 *ngIf="tournament.game_settings.length > 0">
              <div class="button">
                <app-button variant="secondary"
                            (click)="openGameSettings(tournament.game_settings)">{{ 'common.gameSettings' | translate }}</app-button>
              </div>
            </div>
          </div>
        </ng-scrollbar>

      </app-section>
    </div>
  </div>

  <div class="row">
    <div class="spacer"></div>
    <div class="col-md-6 col-12">
      <app-section [title]="'organizer'">
        <app-participant-card
          [isArena]="isMobileView ? false : !!tournament.arena"
          [cover]="tournament.arena ? tournament.arena.cover_picture : tournament.organizer.cover"
          [profile]="tournament.arena ? tournament.arena.profile_picture : tournament.organizer.avatar"
          [name]="tournament.arena ? tournament.arena.name : tournament.organizer.name"
          [arena]="tournament.arena"
          [routeTo]="!!tournament.arena ? '/arenas/'+ tournament?.arena?.slug : '/gamer/' + tournament.organizer.slug "
        >

          <ng-container ngProjectAs="arena-buttons" *ngIf="tournament.arena">
            <app-button variant="primary"
                        [ngClass]="tournament.arena?.is_following ? ('unfollow' | translate ): ('follow' | translate)"
                        (click)="followUnfollowArena(tournament.arena,isFollowingArena ? 'unfollow' : 'follow')">
              <img src="assets/svg-icons/{{(isArenaFollowed$| async)? 'minus-icon' : 'plus-icon'}}.svg"
                   alt=""> {{(isArenaFollowed$| async) ? 'unfollow' : 'follow'}}
            </app-button>

            <app-button variant="white" *ngIf="tournament.arena"
                        (click)="contactDialog = true">{{ 'contact' | translate }}</app-button>
          </ng-container>

          <ng-container ngProjectAs="buttons-bottom" *ngIf="tournament.arena ">
            <app-button variant="primary full-width" class="flex-grow-1"
                        [ngClass]="tournament.arena?.is_following ? ('unfollow' | translate ): ('follow' | translate)"
                        (click)="followUnfollowArena(tournament.arena,isFollowingArena ? 'unfollow' : 'follow')">
              <img src="assets/svg-icons/{{(isArenaFollowed$| async)? 'minus-icon' : 'plus-icon'}}.svg"
                   alt=""> {{(isArenaFollowed$| async) ? 'unfollow' : 'follow'}}
            </app-button>

            <app-button class="flex-grow-1" variant="white full-width" *ngIf="tournament.arena"
                        (click)="contactDialog = true">{{ 'contact' | translate }}
            </app-button>
          </ng-container>
        </app-participant-card>
      </app-section>
    </div>
    <div class="col-md-6 col-12">
      <app-section [title]="'prizes'">
        <ng-container *ngIf="tournament?.prizes?.length > 0; else noPrizes">

          <div class="guaranteed_prizes" *ngIf="tournament.guaranteed_prizes">
            <img src="assets/svg-icons/guranted-prizes.svg">
            <div class="info">
              <span class="title">{{'Prize Guaranteed'}}</span>
              <span>{{'Prize_Guaranteed' | translate}}
                <a
                  target="_blank"
                  href="https://intercom.help/gbarenahelpcenter/en/articles/6392833-guaranteed-prizes-terms-and-conditions">
                  terms & conditions</a>
              </span>
            </div>

          </div>
          <div class="row gy-3">
            <div class="col-lg-6 col-12" *ngFor="let prize of tournament.prizes">
              <app-prize-card [isMultiplePrizes]="prize?.prizes?.length > 0" [prize]="prize"></app-prize-card>
            </div>
          </div>
        </ng-container>
        <ng-template #noPrizes>
          <div class="nodata-placeholder">
            <img src="assets/svg-icons/solid-trophy-icon.svg" alt="">
            <h3>{{ 'no-prize' | translate }}</h3>
            <p class="text-gray">{{ 'tournament.summary.noPrizeMessage' | translate }}</p>
          </div>
        </ng-template>

      </app-section>
    </div>

  </div>

  <div class="spacer"></div>

  <div class="row">
    <div class="col-12">
      <ng-container *ngIf="tournament.description; else description">
        <app-section [title]="'tournament.tournamentDescription' | translate">
          <div class="inner-content description">
            <quill-view-html style="color: white" [content]="tournament.description"></quill-view-html>
          </div>
        </app-section>
      </ng-container>
      <ng-template #description>
        <div class="nodata-placeholder">
          <img src="assets/svg-icons/description-icon.svg" alt="">
          <h3>{{ 'tournament.noDescription' | translate }}</h3>
          <p class="text-gray">{{ 'tournament.summary.descriptionMessage' | translate }}</p>
        </div>
      </ng-template>

    </div>
  </div>

  <nz-modal [(nzVisible)]="contactDialog" nzTitle="{{ 'tournament.summary.organizerInfo' | translate }}"
            [nzClosable]="true"
            [nzFooter]="null"
            (nzOnCancel)="contactDialog = false">
    <ng-container *nzModalContent>
      <ng-container>
        <div class="contacts">
          <ng-container *ngFor="let contact of tournament.contact_details | keyvalue">
            <a class="contact-icon" href="{{ getContactValue(contact)}}" target="_blank"
               *ngIf="contact.value">
              <img src="../../../../assets/svg-icons/{{contact.key}}.svg">
            </a>
          </ng-container>
        </div>
      </ng-container>
    </ng-container>
  </nz-modal>

  <nz-modal [(nzVisible)]="requestsDialog" nzTitle="{{ 'common.pendingRequests' | translate }}" [nzClosable]="true"
            [nzFooter]="null"
            (nzOnCancel)="requestsDialog = false">
    <ng-container *nzModalContent>
      <ng-container>
        <div class="requests">
          <ng-container *ngIf="(isJoinedData$ | async) as data">
            <ng-container *ngFor="let request of data?.requests?.team_joining_request; let i = index">
              <div class="team">
                <div class="info">
                  <div class="avatar">
                    <img width="30" class="border-radius-10" [src]="request?.recipient?.avatar">
                  </div>
                  <div class="d-flex flex-column">
                    <div class="name">{{request?.recipient?.name}}</div>
                    <p><b>{{ 'ownedBy' | translate }}</b> {{request?.recipient?.owner?.username}}</p>
                  </div>
                </div>
                <div class="action">
                  <app-button variant="danger"
                              (click)="cancelJoinRequest(request.id, data?.requests, i)">{{ 'common.buttons.cancel' | translate }}
                  </app-button>
                </div>
              </div>
            </ng-container>
          </ng-container>
        </div>
      </ng-container>
    </ng-container>
  </nz-modal>

</ng-container>
